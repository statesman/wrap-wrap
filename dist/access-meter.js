!function(cmg,$,janrain,plate){function max_reached(prev_return,visits_info,modal_handler){if(prev_return.length)prev_return.hide();else{var allow_passage=visits_info.allow_passage;if(!allow_passage()){var element_names=backend_facade.modal_content_names,pq_modal=modal_handler.fetch_modal("#"+element_names.ROADBLOCK_MODAL),max_visits_elem=pq_modal.find("."+element_names.MAX_VISITS);return max_visits_elem.text(visits_info.visits_so_far+visits_info.visits_left),modal_handler.activate_roadblock_modal(pq_modal,allow_passage)}}}function upsell(prev_return,visits_info,modal_handler){if(prev_return.length)prev_return.hide();else{var element_names=backend_facade.modal_content_names,pq_modal=modal_handler.fetch_modal("#"+element_names.STICKY_MODAL),max_visits_elem=pq_modal.find("."+element_names.MAX_VISITS),visits_count_elem=pq_modal.find("."+element_names.VISITS_COUNT);if(max_visits_elem.text(visits_info.visits_so_far+visits_info.visits_left),visits_count_elem.text(visits_info.visits_so_far),visits_info.allow_passage())return modal_handler.activate_upsell_modal(pq_modal,"viewed",".pq-close-modal")}}function welcome(prev_return,visits_info,modal_handler){if(prev_return.length)prev_return.hide();else{var element_names=backend_facade.modal_content_names,pq_modal=modal_handler.fetch_modal("#"+element_names.WELCOME_MODAL),max_visits_elem=pq_modal.find("."+element_names.MAX_VISITS);if(max_visits_elem.text(visits_info.visits_so_far+visits_info.visits_left),visits_info.allow_passage())return modal_handler.activate_upsell_modal(pq_modal,"viewed",".pq-close-modal")}}function activate_pq(authorized){user_status_pq.authorized(authorized,function(user_status_pq_authorized){backend_facade.metered_object_type(whitelist_pq.check(),whitelist_pq.search_referrer.check(),function(object_type){cmg.passage_quota.check(user_status_pq_authorized,object_type)})})}var root_domain=function(){var segments=window.location.hostname.split(".");return segments.length>1?segments.slice(-2).join("."):null}(),has_local_storage=function(){var result,test_token=(new Date).toString();try{return localStorage.setItem(test_token,test_token),result=localStorage.getItem(test_token)===test_token,localStorage.removeItem(test_token),!(!result||!localStorage)}catch(exception){return console.error("Passage Quota: localStorage error was thrown",exception),!1}}(),device_is=function(){var user_agent=navigator.userAgent||"";return{iPad:null!==user_agent.match(/iPad/i)}}(),WhiteListPQ=function(whitelisted_urls,whitelisted_searches){function SearchReferrer(whitelisted_searches){var checked_search;return{check:function(){if("undefined"==typeof checked_search&&(checked_search=!1,document.referrer))for(var whitelisted,current=add_trailing_slash(document.referrer),i=0;i<whitelisted_searches.length;i++)if(whitelisted="^http[s]?://"+drop_trailing_slash(whitelisted_searches[i]),null!==current.match(new RegExp(whitelisted))){checked_search=!0;break}return checked_search}}}function drop_trailing_slash(url){return url.replace(/\/$/,"")}function add_trailing_slash(url){return""===url?"/":url.replace(/([^\/]$)/,"$1/")}var checked_whitelist,search_referrer=SearchReferrer(whitelisted_searches);return{search_referrer:search_referrer,check:function(){if("undefined"!=typeof checked_whitelist)return checked_whitelist;if(search_referrer.check())return checked_whitelist="referrer";for(var whitelisted,no_wild,current=add_trailing_slash(window.location.pathname),i=0;i<whitelisted_urls.length;i++)if(whitelisted="^"+whitelisted_urls[i],no_wild=whitelisted.replace(/\*\/?$/,""),whitelisted=no_wild===whitelisted?add_trailing_slash(whitelisted)+"$":no_wild,null!==current.match(new RegExp(whitelisted)))return checked_whitelist="white list";return checked_whitelist=!1}}},PassageQuota=function(quota_params){function get_visits_obj(){if(that.visits_obj)return that.visits_obj.period_start=new Date(that.visits_obj.period_start),inject_xdomain_visits(that.visits_obj.visited_paths),that.visits_obj;var stored_visits,period_start,visits_obj={},get_updated_period_start=get_updated_period_start_in_days;return has_local_storage?(visits_obj.type="local_storage",stored_visits=localStorage.getItem(quota_storage_name)):(visits_obj.type="cookie",stored_visits=$.cookie(quota_storage_name,{path:"/",domain:root_domain})),stored_visits?(stored_value=JSON.parse(stored_visits),visits_obj.visited_paths=stored_value.visited_paths,period_start=get_updated_period_start(period_length,new Date(stored_value.period_start))):(visits_obj.visited_paths={metered:{},visited:{}},period_start=get_updated_period_start(period_length)),inject_xdomain_visits(visits_obj.visited_paths),visits_obj.period_start=period_start,update_path_visits_wrt_period_start(visits_obj.visited_paths,period_start),that.get_pq_cookie_expiry_date(period_start),visits_obj}function save_visits_obj(visits_obj){visits_obj.period_start=visits_obj.period_start.getTime();var visited_paths=visits_obj.visited_paths,visited_paths_wo_xdomain_visits=extract_and_save_xdomain_visits(visited_paths);visits_obj.visited_paths=visited_paths_wo_xdomain_visits,"local_storage"===visits_obj.type?localStorage.setItem(quota_storage_name,JSON.stringify(visits_obj)):"cookie"===visits_obj.type&&$.cookie(quota_storage_name,JSON.stringify(visits_obj),{expires:that.get_pq_cookie_expiry_date(),path:"/",domain:root_domain}),visits_obj.visited_paths=visited_paths,that.visits_obj=visits_obj}function get_callback_for_current_visit(visits_left,visits_so_far){return callbacks_for_current_visit[visits_left+"-"]||callbacks_for_current_visit[visits_so_far+"+"]}function check_max_visits(visited_paths){return count_visited_paths(visited_paths)>=get_current_max_visits()}function get_visits_left(visited_paths){return Math.max(get_current_max_visits()-count_visited_paths(visited_paths),0)}function get_current_max_visits(){var current_max_visits;return"number"==typeof max_visits?current_max_visits=max_visits:$.each(max_visits,function(i,m){return"undefined"==typeof max_visit_conditions[i]||max_visit_conditions[i]()?(current_max_visits=m,!1):void 0}),that.internal_data.current_max_visits=current_max_visits,current_max_visits}function count_visited_paths(visited_paths){return _.size(visited_paths.metered)}function path_has_been_visited(path,visited_paths){return path in visited_paths.visited}function include_path_visit(path,visited_paths){path in visited_paths.visited?visited_paths.visited[path]++:(visited_paths.visited[path]=1,visited_paths.metered[path]=(new Date).getTime())}function update_path_visits_wrt_period_start(visited_paths,period_start){var updated_metered={},updated_visted={},original_visited=visited_paths.visited;$.each(visited_paths.metered,function(k,v){period_start<=new Date(v)&&(updated_metered[k]=v,updated_visted[k]=original_visited[k])}),visited_paths.metered=updated_metered,visited_paths.visited=updated_visted}function inject_xdomain_visits(visited_paths){var xdomain_stored_visits=$.cookie(quota_xdomain_split_cookie_name,{path:"/",domain:"."+root_domain}),xdomain_visits={cookie:{},keys:[]};xdomain_stored_visits&&(xdomain_visits.cookie=JSON.parse(xdomain_stored_visits),$.each(xdomain_visits.cookie,function(domain,timestamps){var key;if(domain!==document.domain)for(var i=0;i<timestamps.length;i++)key=domain+"+"+timestamps[i],visited_paths.visited[key]=0,visited_paths.metered[key]=timestamps[i],xdomain_visits.keys.push(key)})),that.xdomain_visits=xdomain_visits}function extract_and_save_xdomain_visits(visited_paths){var xdomain_visits=that.xdomain_visits;return visited_paths_wo_xdomain_visits=remove_xdomain_visits(visited_paths),xdomain_visits.cookie[document.domain]=[],$.each(visited_paths_wo_xdomain_visits.metered,function(url,timestamp){xdomain_visits.cookie[document.domain].push(timestamp)}),$.cookie(quota_xdomain_split_cookie_name,JSON.stringify(xdomain_visits.cookie),{expires:that.get_pq_cookie_expiry_date(),path:"/",domain:"."+root_domain}),visited_paths_wo_xdomain_visits}function remove_xdomain_visits(visited_paths){var updated_visited_paths=JSON.parse(JSON.stringify(visited_paths));return $.each(that.xdomain_visits.keys,function(i,key){delete updated_visited_paths.visited[key],delete updated_visited_paths.metered[key]}),updated_visited_paths}function get_updated_period_start_in_days(period_start,stored_period_start){var initial_date=new Date;if(initial_date.setHours(0,0,0,0),rolling_period){if("number"==typeof period_start)return initial_date.setDate(initial_date.getDate()-period_start),initial_date}else{if("first_of_month"===period_start)return new Date(initial_date.getFullYear(),initial_date.getMonth(),1);if("first_of_week"===period_start)return initial_date.setDate(initial_date.getDate()-initial_date.getDay()),initial_date;if("number"==typeof period_start)return stored_period_start?(initial_date.setDate(initial_date.getDate()-period_start),initial_date>=stored_period_start&&(period_start-1>=(initial_date-stored_period_start)/864e5?stored_period_start.setDate(stored_period_start.getDate()+period_start):(stored_period_start=new Date,stored_period_start.setHours(0,0,0,0))),stored_period_start):initial_date}return console.error("Error while getting quota period start"),initial_date}function apply_previous_post_check_callback(){var callback=saved_post_check_callback.callback.pop();"undefined"!=typeof callback&&callback(saved_post_check_callback.returned.pop(),{allow_passage:that.allow_passage})}function save_post_check_callback(callback,returned){"undefined"!=typeof callback&&"undefined"!=typeof returned&&(saved_post_check_callback.callback.push(callback),saved_post_check_callback.returned.push(returned))}var max_visits=quota_params.max_visits,period_length=quota_params.period_length,rolling_period=quota_params.rolling_period,max_visit_conditions=quota_params.max_visit_conditions,callbacks_for_current_visit=quota_params.callbacks_for_current_visit,that=this,saved_post_check_callback={callback:[],returned:[]};this.quota_params=quota_params,this.internal_data={},this.allow=!1;var quota_storage_name="cmg-quota",quota_xdomain_split_cookie_name="cmg-quota-xdomain",path=window.location.pathname;this.check=function(user_status_pq_authorized,metered_object){if(user_status_pq_authorized)console.info("Passage Quota: USER PQ AUTHORIZED VISIT ALLOWED"),that.allow_passage(!0),$(function(){apply_previous_post_check_callback()}),that.clear_meter();else{var visits_left,visits_so_far,visits_obj=get_visits_obj(),visited_paths=visits_obj.visited_paths,max_visits_reached=check_max_visits(visited_paths);if(!path_has_been_visited(path,visited_paths)&&max_visits_reached&&metered_object?(pq_metrics.track_meter_count("maxmet",get_current_max_visits()),that.allow_passage(!1),console.info("Passage Quota: MAX VISITS REACHED")):(metered_object&&(console.info("Passage Quota: PATH INCLUDED"),include_path_visit(path,visited_paths),pq_metrics.track_meter_count(count_visited_paths(visited_paths),get_current_max_visits())),that.allow_passage(!0),console.info("Passage Quota: VISIT ALLOWED")),console.log(visited_paths.visited),console.log(visited_paths.metered),save_visits_obj(visits_obj),metered_object){console.info("Passage Quota: content type:",metered_object),that.internal_data.metered_object_type=metered_object,visits_left=get_visits_left(visited_paths),visits_so_far=count_visited_paths(visited_paths);var returned,current_post_check_callback=get_callback_for_current_visit(visits_left,visits_so_far);$(function(){apply_previous_post_check_callback(),"undefined"!=typeof current_post_check_callback&&(returned=current_post_check_callback([],{visits_so_far:visits_so_far,visits_left:visits_left,allow_passage:that.allow_passage},that.modal_handler),save_post_check_callback(current_post_check_callback,returned))})}}},this.allow_passage=function(allow){return"undefined"==typeof allow?that.allow:void(that.allow=allow)},this.clear_meter=function(){$.removeCookie(quota_storage_name,{path:"/",domain:root_domain}),has_local_storage&&localStorage.removeItem(quota_storage_name),$.removeCookie(quota_xdomain_split_cookie_name,{path:"/",domain:"."+root_domain})},this.get_pq_cookie_expiry_date=function(period_start){if("undefined"!=typeof period_start){var cookie_expiry_date=new Date;"first_of_month"===period_length?cookie_expiry_date=new Date(period_start.getFullYear(),period_start.getMonth()+1,1):"first_of_week"===period_length?cookie_expiry_date.setTime(period_start.getTime()+6048e5):"number"==typeof period_length&&cookie_expiry_date.setTime(period_start.getTime()+864e5*period_length),that.cookie_expiry_date=cookie_expiry_date}else"undefined"==typeof that.cookie_expiry_date&&console.error("Passage Quota: error setting cookie expiry date given period_start:",period_start);return that.cookie_expiry_date},this.modal_handler={janrain_modal_selector:"#janrainModal",janrain_modal_pq_class:"pq-fixed-janrain-modal",activate_roadblock_modal:function(pq_modal,allow_passage){var handle_pq_modal_visibility=function(janrain_modal_open){allow_passage()||(janrain_modal_open?pq_modal.hide():pq_modal.show())},verify_correct_visibility=function(janrain_modal_selector){var pq_modal_visibility=pq_modal.is(":visible"),janrain_modal_visibility=$(janrain_modal_selector).is(":visible");pq_modal_visibility===janrain_modal_visibility&&location.reload()};return this.modal_found(pq_modal,"roadblock")?this.complete_modal_presentation(pq_modal,handle_pq_modal_visibility,verify_correct_visibility):void 0},activate_upsell_modal:function(pq_modal,data_viewed_key,close_modal_selector){var handle_pq_modal_visibility=function(janrain_modal_open){janrain_modal_open?pq_modal.hide():pq_modal.data(data_viewed_key)||pq_modal.show()},verify_correct_visibility=function(janrain_modal_selector){var pq_modal_visibility=pq_modal.is(":visible"),janrain_modal_visibility=$(janrain_modal_selector).is(":visible");pq_modal_visibility===!0&&pq_modal_visibility===janrain_modal_visibility&&location.reload()};return $(close_modal_selector).click(function(e){e.preventDefault(),pq_modal.data(data_viewed_key,!0),pq_modal.hide()}),this.modal_found(pq_modal,"upsell")?this.complete_modal_presentation(pq_modal,handle_pq_modal_visibility,verify_correct_visibility):void 0},complete_modal_presentation:function(pq_modal,handle_pq_modal_visibility,verify_correct_visibility){return this.link_janrain_with_pq_modal(handle_pq_modal_visibility,verify_correct_visibility),this.pre_show_changes(pq_modal),pq_modal.show(),pq_modal},link_janrain_with_pq_modal:function(handle_pq_modal_visibility,verify_correct_visibility){var modal_handler=this;janrain.events.onModalOpen.addHandler(function(){handle_pq_modal_visibility(!0),verify_correct_visibility(modal_handler.janrain_modal_selector)}),janrain.events.onModalClose.addHandler(function(){handle_pq_modal_visibility(!1),verify_correct_visibility(modal_handler.janrain_modal_selector),device_is.iPad&&window.scrollTo(0,0)}),janrain.events.onCaptureRenderComplete.addHandler(function(){var janrain_modal=$(modal_handler.janrain_modal_selector),modal_height=janrain_modal.outerHeight(!0);modal_height&&(modal_height<$(window).height()?janrain_modal.addClass(modal_handler.janrain_modal_pq_class):janrain_modal.removeClass(modal_handler.janrain_modal_pq_class))})},pre_show_changes:function(pq_modal){var subscriber_link=pq_modal.find("."+backend_facade.modal_content_names.SUBSCRIBER_LINK),dss_match_link=pq_modal.find("."+backend_facade.modal_content_names.DSS_MATCH_LINK),view_offers=backend_facade.modal_content_names.VIEW_OFFERS;pq_modal.find("."+view_offers).click(function(){pq_metrics.track_converted_users(view_offers,pq_modal.attr("id"))});var hide_subscriber_link_and_match_dss=function(profile){subscriber_link.hide();var user_email;user_email=profile&&profile.userData&&profile.userData.email?profile.userData.email:janrain.capture.ui.getReturnExperienceData("email"),user_email&&dss_match_link.attr("href",function(i,href){return href+"&em="+user_email})};janrain.has_active_session_strict()?hide_subscriber_link_and_match_dss():subscriber_link.show(),janrain.events.onCaptureLoginSuccess.addHandler(function(profile){hide_subscriber_link_and_match_dss(profile)}),janrain.events.onCaptureRegistrationSuccess.addHandler(function(){hide_subscriber_link_and_match_dss()})},modal_found:function(pq_modal,modal_name){return pq_modal.length?!0:(console.error("Passage Quota: "+modal_name+" modal not found"),!1)},fetch_modal:function(modal_selector){var pq_modal=$("body > "+modal_selector);return pq_modal.length||(pq_modal=$(modal_selector),pq_modal.appendTo("body")),pq_modal}}},UserStatusPQ=function(backend_facade){function apply_pq_given_auth_status(args){var backend_authorized=args.backend_authorized,pq_callback=args.callback;if(that.janrain_session_found=args.janrain_session_found,"undefined"!=typeof pq_callback)if(!backend_authorized||!crisis_enabled&&open_house_req_registration){var auth_type=get_auth_type();if(!verify_soundness(auth_type))return void console.error("UserStatusPQ: exiting due to unsound status");pq_callback(open_house_req_registration?!status_is("anonymous",auth_type):open_house_enabled?!0:status_is("subscribed",auth_type)||status_is("admin",auth_type))}else pq_callback(!0);else console.error("UserStatus has no callback to apply.")}function verify_soundness(auth_type){function assert(condition,message){condition||(message="undefined"!=typeof message?", "+message:"",message=message+" conditions=["+status_conditions.toString()+"]",sound=!1,console.error("UserStatusPQ Error: soundness verification failed"+message))}var sound=!0,is_anonymous=status_is("anonymous",auth_type),is_registered=status_is("registered",auth_type),is_subscribed=status_is("subscribed",auth_type),is_admin=status_is("admin",auth_type),status_conditions=[is_anonymous,is_registered,is_subscribed,is_admin];return assert(status_conditions.every(function(v){return!(null===v||"undefined"==typeof v)}),"at least one status condition is still unassigned."),assert(!(is_anonymous&&(is_registered||is_subscribed||is_admin))&&(is_registered||is_subscribed||is_anonymous||is_admin),"anonymous status out of sync with registered, subscribed and admin."),assert(!is_subscribed||is_registered,"subscribed but not registered."),sound}var that=this,get_auth_type=backend_facade.get_auth_type,open_house_req_registration=backend_facade.site_settings.open_house_req_registration,open_house_enabled=backend_facade.site_settings.open_house_enabled,crisis_enabled=backend_facade.site_settings.crisis_enabled;this.authorized=function(backend_authorized,callback){event_consolidator.apply_on_ready("auth_check",{callback:callback,backend_authorized:backend_authorized})},janrain.on("cmg_ready",function(){"undefined"!=typeof janrain.capture&&janrain.capture.ui.hasActiveSession()?event_consolidator.apply_on_ready("session-found",{janrain_session_found:!0}):janrain.events.onCaptureSessionFound.addHandler(function(){event_consolidator.apply_on_ready("session-found",{janrain_session_found:!0})}),janrain.events.onCaptureSessionNotFound.addHandler(function(){event_consolidator.apply_on_ready("no-session-found",{janrain_session_found:!1})}),janrain.on("cmg_login_complete",function(){event_consolidator.apply_on_ready("login-complete",{janrain_session_found:!0})})});var event_consolidator=function(){function reset_events(){auth_check=!1,other_event=!1,full_args={}}function ensure_event_consolidator_completed(){setTimeout(function(){applied?console.info("UserStatusPQ: event consolidator successfully completed"):console.error("UserStatusPQ: event consolidator did not complete after the expected time",{auth_check:auth_check,other_event:other_event,applied:applied})},15e3)}var auth_check=!1,other_event=!1,applied=!1,called_events={},full_args={};return{apply_on_ready:function(event,partial_args){var partial_args=partial_args||{};if("auth_check"===event)ensure_event_consolidator_completed(),auth_check=!0;else{if(("no-session-found"===event||"session-found"===event)&&event in called_events)return;other_event=event,called_events[event]=1}for(var a in partial_args)full_args[a]=partial_args[a];auth_check&&other_event?(apply_pq_given_auth_status(full_args),applied=!0,reset_events()):applied=!1}}}(),status_is=function(status,auth_type){return status in check_status_from_auth_type?check_status_from_auth_type[status](auth_type):void 0},check_status_from_auth_type={anonymous:function(auth_type){return!(check_status_from_auth_type.registered(auth_type)||check_status_from_auth_type.admin(auth_type)||auth_type&&"openhousereg"!==auth_type)},registered:function(auth_type){return"undefined"!=typeof that.janrain_session_found&&that.janrain_session_found},subscribed:function(auth_type){return check_status_from_auth_type.registered(auth_type)&&!!auth_type&&"mg2"===auth_type},admin:function(auth_type){return!!auth_type&&"staff"===auth_type}}},backend_facade=function(){var auth_types=["openhousereg","staff","mg2"],metered_object_types={"weblogs.medleyblog":1,"feed_importer.importedfeeditem":1,"photos.medleygallery":1,"news.medleydocument":1,"overrides.myflatpage":1,"weblogs.medleyentry":1,"videos.vendorvideo":1,"apjobs.apstory":1,"apjobs.apphoto":1,"news.medleystory":1,"maps.staticmap":1,"photos.medleyphoto":1},modal_content_names={ROADBLOCK_MODAL:"pq-passage-quota-block",VISITS_COUNT:"pq-passage-quota-count",SUBSCRIBER_LINK:"pq-modal-subscriber-link",STICKY_MODAL:"pq-passage-quota-sticky",VIEW_OFFERS:"pq-passage-quota-view-offers",MAX_VISITS:"pq-passage-quota-max",WELCOME_MODAL:"pq-passage-quota-welcome",DSS_MATCH_LINK:"pq-dss-match"},get_auth_type_from_source=function(){return cmg.authorization.auth_type()},site_settings={open_house_req_registration:!1,reg_visits_threshold:parseInt("5"),open_house_enabled:!1,crisis_enabled:!1,whitelisted_urls:"/,\r\n/services/*, \r\n/visitor_agreement/, \r\n/privacy_policy/, \r\n/weather/, \r\n/sports/scores/, \r\n/news/online/faqs-day-pass/nZnWy/,\r\n/category/*,\r\n/author/*,\r\n/99-cent-offer-newsletter/,\r\n/99-cent-offer-newsletter-round-2/,\r\n/digitalsubscription/"};!isNaN(site_settings.reg_visits_threshold)||site_settings.crisis_enabled||!site_settings.open_house_req_registration&&site_settings.open_house_enabled||(site_settings.open_house_enabled=!0,console.error("Site Setting Error: site setting reg_visits_threshold is either missing or is not a number. All visits are allowed until the issue is fixed."));var whitelisted_urls;return""!==site_settings.whitelisted_urls?(whitelisted_urls=site_settings.whitelisted_urls.replace(/\n/g,"").split(","),site_settings.whitelisted_urls=[],whitelisted_urls.forEach(function(w){""!==w&&site_settings.whitelisted_urls.push(w.trim())})):site_settings.whitelisted_urls=[],{site_settings:site_settings,modal_content_names:modal_content_names,get_auth_type:function(){for(var return_type,current_type=get_auth_type_from_source(),i=0;i<auth_types.length;i++)if(return_type=auth_types[i],"string"==typeof return_type&&current_type.toLowerCase().match(return_type))return return_type},metered_object_type:function(whitelisted,referred,callback){function apply_pq_callback(callback,referred,object_type){if("undefined"==typeof backend_facade.object_type){if("undefined"==typeof object_type)return!1;backend_facade.object_type=object_type,apply_if_not_referred(callback,referred,object_type)}else apply_if_not_referred(callback,referred,object_type);return!0}function apply_if_not_referred(callback,referred,object_type){pq_metrics.track_content_view_type(!!object_type),referred?log_exit_reason("visit","referrer"):callback(object_type)}function log_exit_reason(subject,reason){console.info("Passage Quota: exiting because "+subject+" is not metered as determined by "+reason)}if(!apply_pq_callback(callback,referred)){if(whitelisted&&!referred)return void log_exit_reason("visit",whitelisted);if(plate.premium)return void apply_pq_callback(callback,referred,"plate.wrap");var object_type,x_object_type,json_return={};if("undefined"!=typeof json_return.type_set)object_type=json_return.object_type,object_type?apply_pq_callback(callback,referred,object_type):log_exit_reason("object type","json");else{var _jqxhr;$.get(location.pathname).done(function(data,textStatus,jqxhr){_jqxhr=jqxhr}).fail(function(jqxhr){_jqxhr=jqxhr}).always(function(){x_object_type=_jqxhr.getResponseHeader("x-object-type"),x_object_type in metered_object_types?apply_pq_callback(callback,referred,x_object_type):log_exit_reason("object type","ajax response header")})}}}}}(),pq_metrics=function(cmg){function track_event(params,elem,value){if(has_metrics_obj()){for(var other,payload=[params.event,elem,[params.eVar,params.prop,value]],i=0;i<params.other_metrics.length;i++)other=params.other_metrics[i],payload.push(["eVar"+other,"prop"+other,metrics_obj["eVar"+other]]);payload.push(params.desc),metrics_obj.utilities.track_event.apply(null,payload),captured_metrics[params.eVar]=captured_metrics[params.prop]=value}}function track_non_event(params,value){has_metrics_obj()&&("function"==typeof params.pre_cookie&&(value=params.pre_cookie(value)),value=check_with_cookie(params.cookie,value),("undefined"==typeof value||null===value)&&(value=params.default_val),"function"==typeof params.pre_capture&&(value=params.pre_capture(value)),metrics_obj[params.eVar]=metrics_obj[params.prop]=value,captured_metrics[params.eVar]=captured_metrics[params.prop]=value)}function check_with_cookie(cookie_name,value){return"undefined"!=typeof cookie_name&&(cookie_name=cookie_name_prefix+cookie_name,"undefined"!=typeof value?$.cookie(cookie_name,value,{expires:cmg.passage_quota.get_pq_cookie_expiry_date(),path:"/",domain:"."+root_domain}):value=$.cookie(cookie_name,{path:"/",domain:"."+root_domain})),value}function has_metrics_obj(){return metrics_obj=metrics_obj||eval(metrics_obj_name),"undefined"!=typeof metrics_obj?!0:(console.error("PQ Metrics: metrics not captured because "+metrics_obj_name+" is undefined"),!1)}function metrics_consolidator(expected_other_metrics,base_metric_timeout){function reset_metrics(){metrics_base_call=!1,reset_other_metrics()}function reset_other_metrics(){$.each(expected_other_metrics,function(i,metric){other_metrics[metric]=!1})}function ensure_metrics_base_applied(timeout){setTimeout(function(){applied?console.info("PQ Metrics: metrics fired successfully with passage quota metrics consolidator"):(metrics_base_call(),console.info("PQ Metrics: metrics fired w/o metrics consolidator"))},timeout)}function all_other_metrics_applied(){var all_applied=!0;return $.each(other_metrics,function(metric,metric_applied){return metric_applied?void 0:(all_applied=!1,!1)}),all_applied}var other_metrics={};reset_other_metrics();var applied=!1,metrics_base_call=!1;return{apply_on_ready:function(metric_callback,metric,args){args=args||{},"base"===metric?(ensure_metrics_base_applied(base_metric_timeout),metrics_base_call=metric_callback):metric in other_metrics?(metric_callback.apply(null,args),other_metrics[metric]=!0):console.warn("PQ Metrics: metric callback was not included in the initial setup, metric:",metric,"other metrics:",other_metrics),metrics_base_call&&all_other_metrics_applied()?(applied=!0,metrics_base_call(),reset_metrics()):applied=!1}}}cmg.metrics_consolidator=metrics_consolidator(["meter_count/meter_max","content_view_type"],1e4);var cookie_name_prefix="cmg-quota-metrics-",metrics_interface,metrics_obj,metrics_obj_name,captured_metrics={};if(flipper.is_active("DTMmetrics_Enable"))metrics_obj_name="cmg.DDO",metrics_interface={track_converted_users:function(elem,modal_value){has_metrics_obj()&&metrics_obj.action("accessMeter",{site_element_name:modal_value,site_element_action:"click"})},track_meter_count:function(count,max){has_metrics_obj()&&(metrics_obj.accessMeterData.meter_count=count.toString(),metrics_obj.accessMeterData.meter_max=max.toString())},track_content_view_type:function(metered){if(has_metrics_obj()){var view_type_value;view_type_value=metered?"metered":"non-metered",metrics_obj.accessMeterData.meter_content_view_type=view_type_value}}};else{var view_offers={eVar:"eVar71",prop:"prop71",event:"75",desc:"Meter Interaction",other_metrics:["2","48"]},meter_count={eVar:"eVar72",prop:"prop72",desc:"Current Page #",cookie:"pq-count",default_val:"0",maxmet:"maxmet",pre_cookie:function(value){return captured_metrics[this.prop]===this.maxmet&&captured_metrics[this.eVar]===this.maxmet&&captured_metrics[meter_max.prop]===value&&captured_metrics[meter_max.eVar]===value&&(value=this.maxmet),value},pre_capture:function(value){return whitelist_pq.search_referrer.check()&&(value+=":search"),value}},meter_max={eVar:"eVar73",prop:"prop73",desc:"Max Page #",cookie:"pq-max",default_val:backend_facade.site_settings.reg_visits_threshold.toString()},meter_content_view_type={eVar:"eVar52",prop:"prop52",desc:"Content View Type",default_val:"non-metered"},meter_janrain_id={eVar:"eVar2",prop:"prop2",desc:"Janrain ID"};metrics_obj_name="cmg.s_coxnews",metrics_interface={track_converted_users:function(elem,modal_value){track_event(view_offers,elem,modal_value)},track_meter_count:function(count,max){"undefined"!=typeof count&&"undefined"!=typeof max?cmg.metrics_consolidator.apply_on_ready(function(count_value,max_value){track_non_event(meter_count,count_value),track_non_event(meter_max,max_value)},"meter_count/meter_max",[count.toString(),max.toString()]):(track_non_event(meter_count),track_non_event(meter_max))},track_content_view_type:function(metered){if("undefined"!=typeof metered){var view_type_value;view_type_value=metered?"metered":"non-metered",cmg.metrics_consolidator.apply_on_ready(track_non_event,"content_view_type",[meter_content_view_type,view_type_value])}else track_non_event(meter_content_view_type)},track_janrain_id:function(janrain_id){track_non_event(meter_janrain_id,janrain_id)}}}return{track_converted_users:function(elem,modal_id){var modal_value;modal_id===backend_facade.modal_content_names.STICKY_MODAL?modal_value="view all offers: sticky":modal_id===backend_facade.modal_content_names.ROADBLOCK_MODAL&&(modal_value="view all offers: roadblock"),metrics_interface.track_converted_users(elem,modal_value)},track_meter_count:metrics_interface.track_meter_count,track_content_view_type:metrics_interface.track_content_view_type,track_janrain_id:metrics_interface.track_janrain_id}}(cmg);cmg.passage_quota=new PassageQuota({max_visits:backend_facade.site_settings.reg_visits_threshold,period_length:"first_of_month",rolling_period:!1,max_visit_conditions:[],callbacks_for_current_visit:{"0-":max_reached,"1-":upsell,"1+":welcome}});var whitelist_pq=new WhiteListPQ(backend_facade.site_settings.whitelisted_urls,["news.google.com","www.google.com","www.bing.com"]),user_status_pq=new UserStatusPQ(backend_facade),auth_url="http://www.mystatesman.com/profile/janus-auth/";$(function(){if(pq_metrics.track_meter_count(),pq_metrics.track_content_view_type(),plate.getAliasParameters){var alias=plate.getAliasParameters();alias&&alias.u&&pq_metrics.track_janrain_id(alias.u)}}),cmg.authorization.check(auth_url,function(data){activate_pq(data.authorized)})}(window.cmg||(window.cmg={}),cmg.query||window.jQuery,window.janrain,window.plate||{}),"undefined"!=typeof window.plate&&"undefined"!=typeof wrap&&wrap.hasOwnProperty("premium")&&(window.plate.premium=wrap.premium);