!function(cmg,$,janrain,plate){function max_reached(a,b,c){if(a.length)a.hide();else{var d=b.allow_passage;if(!d()){var e=backend_facade.modal_content_names,f=c.fetch_modal("#"+e.ROADBLOCK_MODAL),g=f.find("."+e.MAX_VISITS);return g.text(b.visits_so_far+b.visits_left),c.activate_roadblock_modal(f,d)}}}function upsell(a,b,c){if(a.length)a.hide();else{var d=backend_facade.modal_content_names,e=c.fetch_modal("#"+d.STICKY_MODAL),f=e.find("."+d.MAX_VISITS),g=e.find("."+d.VISITS_COUNT);if(f.text(b.visits_so_far+b.visits_left),g.text(b.visits_so_far),b.allow_passage())return c.activate_upsell_modal(e,"viewed",".pq-close-modal")}}function welcome(a,b,c){if(a.length)a.hide();else{var d=backend_facade.modal_content_names,e=c.fetch_modal("#"+d.WELCOME_MODAL),f=e.find("."+d.MAX_VISITS);if(f.text(b.visits_so_far+b.visits_left),b.allow_passage())return c.activate_upsell_modal(e,"viewed",".pq-close-modal")}}function activate_pq(a){user_status_pq.authorized(a,function(a){backend_facade.metered_object_type(whitelist_pq.check(),whitelist_pq.search_referrer.check(),function(b){cmg.passage_quota.check(a,b)})})}var root_domain=function(){var a=window.location.hostname.split(".");return a.length>1?a.slice(-2).join("."):null}(),has_local_storage=function(){var a,b=(new Date).toString();try{return localStorage.setItem(b,b),a=localStorage.getItem(b)===b,localStorage.removeItem(b),!(!a||!localStorage)}catch(c){return console.error("Passage Quota: localStorage error was thrown",c),!1}}(),device_is=function(){var a=navigator.userAgent||"";return{iPad:null!==a.match(/iPad/i)}}(),WhiteListPQ=function(a,b){function c(a){var b;return{check:function(){if("undefined"==typeof b&&(b=!1,document.referrer))for(var c,f=e(document.referrer),g=0;g<a.length;g++)if(c="^http[s]?://"+d(a[g]),null!==f.match(new RegExp(c))){b=!0;break}return b}}}function d(a){return a.replace(/\/$/,"")}function e(a){return""===a?"/":a.replace(/([^\/]$)/,"$1/")}var f,g=c(b);return{search_referrer:g,check:function(){if("undefined"!=typeof f)return f;if(g.check())return f="referrer";for(var b,c,d=e(window.location.pathname),h=0;h<a.length;h++)if(b="^"+a[h],c=b.replace(/\*\/?$/,""),b=c===b?e(b)+"$":c,null!==d.match(new RegExp(b)))return f="white list";return f=!1}}},PassageQuota=function(a){function b(){if(w.visits_obj)return w.visits_obj.period_start=new Date(w.visits_obj.period_start),l(w.visits_obj.visited_paths),w.visits_obj;var a,b,c={},d=o;return has_local_storage?(c.type="local_storage",a=localStorage.getItem(y)):(c.type="cookie",a=$.cookie(y,{path:"/",domain:root_domain})),a?(stored_value=JSON.parse(a),c.visited_paths=stored_value.visited_paths,b=d(s,new Date(stored_value.period_start))):(c.visited_paths={metered:{},visited:{}},b=d(s)),l(c.visited_paths),c.period_start=b,k(c.visited_paths,b),w.get_pq_cookie_expiry_date(b),c}function c(a){a.period_start=a.period_start.getTime();var b=a.visited_paths,c=m(b);a.visited_paths=c,"local_storage"===a.type?localStorage.setItem(y,JSON.stringify(a)):"cookie"===a.type&&$.cookie(y,JSON.stringify(a),{expires:w.get_pq_cookie_expiry_date(),path:"/",domain:root_domain}),a.visited_paths=b,w.visits_obj=a}function d(a,b){return v[a+"-"]||v[b+"+"]}function e(a){return h(a)>=g()}function f(a){return Math.max(g()-h(a),0)}function g(){var a;return"number"==typeof r?a=r:$.each(r,function(b,c){return"undefined"==typeof u[b]||u[b]()?(a=c,!1):void 0}),w.internal_data.current_max_visits=a,a}function h(a){return _.size(a.metered)}function i(a,b){return a in b.visited}function j(a,b){a in b.visited?b.visited[a]++:(b.visited[a]=1,b.metered[a]=(new Date).getTime())}function k(a,b){var c={},d={},e=a.visited;$.each(a.metered,function(a,f){b<=new Date(f)&&(c[a]=f,d[a]=e[a])}),a.metered=c,a.visited=d}function l(a){var b=$.cookie(z,{path:"/",domain:"."+root_domain}),c={cookie:{},keys:[]};b&&(c.cookie=JSON.parse(b),$.each(c.cookie,function(b,d){var e;if(b!==document.domain)for(var f=0;f<d.length;f++)e=b+"+"+d[f],a.visited[e]=0,a.metered[e]=d[f],c.keys.push(e)})),w.xdomain_visits=c}function m(a){var b=w.xdomain_visits;return visited_paths_wo_xdomain_visits=n(a),b.cookie[document.domain]=[],$.each(visited_paths_wo_xdomain_visits.metered,function(a,c){b.cookie[document.domain].push(c)}),$.cookie(z,JSON.stringify(b.cookie),{expires:w.get_pq_cookie_expiry_date(),path:"/",domain:"."+root_domain}),visited_paths_wo_xdomain_visits}function n(a){var b=JSON.parse(JSON.stringify(a));return $.each(w.xdomain_visits.keys,function(a,c){delete b.visited[c],delete b.metered[c]}),b}function o(a,b){var c=new Date;if(c.setHours(0,0,0,0),t){if("number"==typeof a)return c.setDate(c.getDate()-a),c}else{if("first_of_month"===a)return new Date(c.getFullYear(),c.getMonth(),1);if("first_of_week"===a)return c.setDate(c.getDate()-c.getDay()),c;if("number"==typeof a)return b?(c.setDate(c.getDate()-a),c>=b&&(a-1>=(c-b)/864e5?b.setDate(b.getDate()+a):(b=new Date,b.setHours(0,0,0,0))),b):c}return console.error("Error while getting quota period start"),c}function p(){var a=x.callback.pop();"undefined"!=typeof a&&a(x.returned.pop(),{allow_passage:w.allow_passage})}function q(a,b){"undefined"!=typeof a&&"undefined"!=typeof b&&(x.callback.push(a),x.returned.push(b))}var r=a.max_visits,s=a.period_length,t=a.rolling_period,u=a.max_visit_conditions,v=a.callbacks_for_current_visit,w=this,x={callback:[],returned:[]};this.quota_params=a,this.internal_data={},this.allow=!1;var y="cmg-quota",z="cmg-quota-xdomain",A=window.location.pathname;this.check=function(a,k){if(a)console.info("Passage Quota: USER PQ AUTHORIZED VISIT ALLOWED"),w.allow_passage(!0),$(function(){p()}),w.clear_meter();else{var l,m,n=b(),o=n.visited_paths,r=e(o);if(!i(A,o)&&r&&k?(pq_metrics.track_meter_count("maxmet",g()),w.allow_passage(!1),console.info("Passage Quota: MAX VISITS REACHED")):(k&&(console.info("Passage Quota: PATH INCLUDED"),j(A,o),pq_metrics.track_meter_count(h(o),g())),w.allow_passage(!0),console.info("Passage Quota: VISIT ALLOWED")),console.log(o.visited),console.log(o.metered),c(n),k){console.info("Passage Quota: content type:",k),w.internal_data.metered_object_type=k,l=f(o),m=h(o);var s,t=d(l,m);$(function(){p(),"undefined"!=typeof t&&(s=t([],{visits_so_far:m,visits_left:l,allow_passage:w.allow_passage},w.modal_handler),q(t,s))})}}},this.allow_passage=function(a){return"undefined"==typeof a?w.allow:void(w.allow=a)},this.clear_meter=function(){$.removeCookie(y,{path:"/",domain:root_domain}),has_local_storage&&localStorage.removeItem(y),$.removeCookie(z,{path:"/",domain:"."+root_domain})},this.get_pq_cookie_expiry_date=function(a){if("undefined"!=typeof a){var b=new Date;"first_of_month"===s?b=new Date(a.getFullYear(),a.getMonth()+1,1):"first_of_week"===s?b.setTime(a.getTime()+6048e5):"number"==typeof s&&b.setTime(a.getTime()+864e5*s),w.cookie_expiry_date=b}else"undefined"==typeof w.cookie_expiry_date&&console.error("Passage Quota: error setting cookie expiry date given period_start:",a);return w.cookie_expiry_date},this.modal_handler={janrain_modal_selector:"#janrainModal",janrain_modal_pq_class:"pq-fixed-janrain-modal",activate_roadblock_modal:function(a,b){var c=function(c){b()||(c?a.hide():a.show())},d=function(b){var c=a.is(":visible"),d=$(b).is(":visible");c===d&&location.reload()};return this.modal_found(a,"roadblock")?this.complete_modal_presentation(a,c,d):void 0},activate_upsell_modal:function(a,b,c){var d=function(c){c?a.hide():a.data(b)||a.show()},e=function(b){var c=a.is(":visible"),d=$(b).is(":visible");c===!0&&c===d&&location.reload()};return $(c).click(function(c){c.preventDefault(),a.data(b,!0),a.hide()}),this.modal_found(a,"upsell")?this.complete_modal_presentation(a,d,e):void 0},complete_modal_presentation:function(a,b,c){return this.link_janrain_with_pq_modal(b,c),this.pre_show_changes(a),a.show(),a},link_janrain_with_pq_modal:function(a,b){var c=this;janrain.events.onModalOpen.addHandler(function(){a(!0),b(c.janrain_modal_selector)}),janrain.events.onModalClose.addHandler(function(){a(!1),b(c.janrain_modal_selector),device_is.iPad&&window.scrollTo(0,0)}),janrain.events.onCaptureRenderComplete.addHandler(function(){var a=$(c.janrain_modal_selector),b=a.outerHeight(!0);b&&(b<$(window).height()?a.addClass(c.janrain_modal_pq_class):a.removeClass(c.janrain_modal_pq_class))})},pre_show_changes:function(a){var b=a.find("."+backend_facade.modal_content_names.SUBSCRIBER_LINK),c=a.find("."+backend_facade.modal_content_names.DSS_MATCH_LINK),d=backend_facade.modal_content_names.VIEW_OFFERS;a.find("."+d).click(function(){pq_metrics.track_converted_users(d,a.attr("id"))});var e=function(a){b.hide();var d;d=a&&a.userData&&a.userData.email?a.userData.email:janrain.capture.ui.getReturnExperienceData("email"),d&&c.attr("href",function(a,b){return b+"&em="+d})};janrain.has_active_session_strict()?e():b.show(),janrain.events.onCaptureLoginSuccess.addHandler(function(a){e(a)}),janrain.events.onCaptureRegistrationSuccess.addHandler(function(){e()})},modal_found:function(a,b){return a.length?!0:(console.error("Passage Quota: "+b+" modal not found"),!1)},fetch_modal:function(a){var b=$("body > "+a);return b.length||(b=$(a),b.appendTo("body")),b}}},UserStatusPQ=function(a){function b(a){var b=a.backend_authorized,i=a.callback;if(d.janrain_session_found=a.janrain_session_found,"undefined"!=typeof i)if(!b||!h&&f){var k=e();if(!c(k))return void console.error("UserStatusPQ: exiting due to unsound status");i(f?!j("anonymous",k):g?!0:j("subscribed",k)||j("admin",k))}else i(!0);else console.error("UserStatus has no callback to apply.")}function c(a){function b(a,b){a||(b="undefined"!=typeof b?", "+b:"",b=b+" conditions=["+h.toString()+"]",c=!1,console.error("UserStatusPQ Error: soundness verification failed"+b))}var c=!0,d=j("anonymous",a),e=j("registered",a),f=j("subscribed",a),g=j("admin",a),h=[d,e,f,g];return b(h.every(function(a){return!(null===a||"undefined"==typeof a)}),"at least one status condition is still unassigned."),b(!(d&&(e||f||g))&&(e||f||d||g),"anonymous status out of sync with registered, subscribed and admin."),b(!f||e,"subscribed but not registered."),c}var d=this,e=a.get_auth_type,f=a.site_settings.open_house_req_registration,g=a.site_settings.open_house_enabled,h=a.site_settings.crisis_enabled;this.authorized=function(a,b){i.apply_on_ready("auth_check",{callback:b,backend_authorized:a})},janrain.on("cmg_ready",function(){"undefined"!=typeof janrain.capture&&janrain.capture.ui.hasActiveSession()?i.apply_on_ready("session-found",{janrain_session_found:!0}):janrain.events.onCaptureSessionFound.addHandler(function(){i.apply_on_ready("session-found",{janrain_session_found:!0})}),janrain.events.onCaptureSessionNotFound.addHandler(function(){i.apply_on_ready("no-session-found",{janrain_session_found:!1})}),janrain.on("cmg_login_complete",function(){i.apply_on_ready("login-complete",{janrain_session_found:!0})})});var i=function(){function a(){d=!1,e=!1,h={}}function c(){setTimeout(function(){f?console.info("UserStatusPQ: event consolidator successfully completed"):console.error("UserStatusPQ: event consolidator did not complete after the expected time",{auth_check:d,other_event:e,applied:f})},15e3)}var d=!1,e=!1,f=!1,g={},h={};return{apply_on_ready:function(i,j){var j=j||{};if("auth_check"===i)c(),d=!0;else{if(("no-session-found"===i||"session-found"===i)&&i in g)return;e=i,g[i]=1}for(var k in j)h[k]=j[k];d&&e?(b(h),f=!0,a()):f=!1}}}(),j=function(a,b){return a in k?k[a](b):void 0},k={anonymous:function(a){return!(k.registered(a)||k.admin(a)||a&&"openhousereg"!==a)},registered:function(a){return"undefined"!=typeof d.janrain_session_found&&d.janrain_session_found},subscribed:function(a){return k.registered(a)&&!!a&&"mg2"===a},admin:function(a){return!!a&&"staff"===a}}},backend_facade=function(){var a=["openhousereg","staff","mg2"],b={"weblogs.medleyblog":1,"feed_importer.importedfeeditem":1,"photos.medleygallery":1,"news.medleydocument":1,"overrides.myflatpage":1,"weblogs.medleyentry":1,"videos.vendorvideo":1,"apjobs.apstory":1,"apjobs.apphoto":1,"news.medleystory":1,"maps.staticmap":1,"photos.medleyphoto":1},c={ROADBLOCK_MODAL:"pq-passage-quota-block",VISITS_COUNT:"pq-passage-quota-count",SUBSCRIBER_LINK:"pq-modal-subscriber-link",STICKY_MODAL:"pq-passage-quota-sticky",VIEW_OFFERS:"pq-passage-quota-view-offers",MAX_VISITS:"pq-passage-quota-max",WELCOME_MODAL:"pq-passage-quota-welcome",DSS_MATCH_LINK:"pq-dss-match"},d=function(){return cmg.authorization.auth_type()},e={open_house_req_registration:!1,reg_visits_threshold:parseInt("5"),open_house_enabled:!1,crisis_enabled:!1,whitelisted_urls:"/,\r\n/services/*, \r\n/visitor_agreement/, \r\n/privacy_policy/, \r\n/weather/, \r\n/sports/scores/, \r\n/news/online/faqs-day-pass/nZnWy/,\r\n/category/*,\r\n/author/*,\r\n/99-cent-offer-newsletter/,\r\n/99-cent-offer-newsletter-round-2/,\r\n/digitalsubscription/"};!isNaN(e.reg_visits_threshold)||e.crisis_enabled||!e.open_house_req_registration&&e.open_house_enabled||(e.open_house_enabled=!0,console.error("Site Setting Error: site setting reg_visits_threshold is either missing or is not a number. All visits are allowed until the issue is fixed."));var f;return""!==e.whitelisted_urls?(f=e.whitelisted_urls.replace(/\n/g,"").split(","),e.whitelisted_urls=[],f.forEach(function(a){""!==a&&e.whitelisted_urls.push(a.trim())})):e.whitelisted_urls=[],{site_settings:e,modal_content_names:c,get_auth_type:function(){for(var b,c=d(),e=0;e<a.length;e++)if(b=a[e],"string"==typeof b&&c.toLowerCase().match(b))return b},metered_object_type:function(a,c,d){function e(a,b,c){if("undefined"==typeof backend_facade.object_type){if("undefined"==typeof c)return!1;backend_facade.object_type=c,f(a,b,c)}else f(a,b,c);return!0}function f(a,b,c){pq_metrics.track_content_view_type(!!c),b?g("visit","referrer"):a(c)}function g(a,b){console.info("Passage Quota: exiting because "+a+" is not metered as determined by "+b)}if(!e(d,c)){if(a&&!c)return void g("visit",a);if(plate.premium)return void e(d,c,"plate.wrap");var h,i,j={};if("undefined"!=typeof j.type_set)h=j.object_type,h?e(d,c,h):g("object type","json");else{var k;$.get(location.pathname).done(function(a,b,c){k=c}).fail(function(a){k=a}).always(function(){i=k.getResponseHeader("x-object-type"),i in b?e(d,c,i):g("object type","ajax response header")})}}}}}(),pq_metrics=function(cmg){function track_event(a,b,c){if(has_metrics_obj()){for(var d,e=[a.event,b,[a.eVar,a.prop,c]],f=0;f<a.other_metrics.length;f++)d=a.other_metrics[f],e.push(["eVar"+d,"prop"+d,metrics_obj["eVar"+d]]);e.push(a.desc),metrics_obj.utilities.track_event.apply(null,e),captured_metrics[a.eVar]=captured_metrics[a.prop]=c}}function track_non_event(a,b){has_metrics_obj()&&("function"==typeof a.pre_cookie&&(b=a.pre_cookie(b)),b=check_with_cookie(a.cookie,b),("undefined"==typeof b||null===b)&&(b=a.default_val),"function"==typeof a.pre_capture&&(b=a.pre_capture(b)),metrics_obj[a.eVar]=metrics_obj[a.prop]=b,captured_metrics[a.eVar]=captured_metrics[a.prop]=b)}function check_with_cookie(a,b){return"undefined"!=typeof a&&(a=cookie_name_prefix+a,"undefined"!=typeof b?$.cookie(a,b,{expires:cmg.passage_quota.get_pq_cookie_expiry_date(),path:"/",domain:"."+root_domain}):b=$.cookie(a,{path:"/",domain:"."+root_domain})),b}function has_metrics_obj(){return metrics_obj=metrics_obj||eval(metrics_obj_name),"undefined"!=typeof metrics_obj?!0:(console.error("PQ Metrics: metrics not captured because "+metrics_obj_name+" is undefined"),!1)}function metrics_consolidator(a,b){function c(){i=!1,d()}function d(){$.each(a,function(a,b){g[b]=!1})}function e(a){setTimeout(function(){h?console.info("PQ Metrics: metrics fired successfully with passage quota metrics consolidator"):(i(),console.info("PQ Metrics: metrics fired w/o metrics consolidator"))},a)}function f(){var a=!0;return $.each(g,function(b,c){return c?void 0:(a=!1,!1)}),a}var g={};d();var h=!1,i=!1;return{apply_on_ready:function(a,d,j){j=j||{},"base"===d?(e(b),i=a):d in g?(a.apply(null,j),g[d]=!0):console.warn("PQ Metrics: metric callback was not included in the initial setup, metric:",d,"other metrics:",g),i&&f()?(h=!0,i(),c()):h=!1}}}cmg.metrics_consolidator=metrics_consolidator(["meter_count/meter_max","content_view_type"],1e4);var cookie_name_prefix="cmg-quota-metrics-",metrics_interface,metrics_obj,metrics_obj_name,captured_metrics={};if(flipper.is_active("DTMmetrics_Enable"))metrics_obj_name="cmg.DDO",metrics_interface={track_converted_users:function(a,b){has_metrics_obj()&&metrics_obj.action("accessMeter",{site_element_name:b,site_element_action:"click"})},track_meter_count:function(a,b){has_metrics_obj()&&(metrics_obj.accessMeterData.meter_count=a.toString(),metrics_obj.accessMeterData.meter_max=b.toString())},track_content_view_type:function(a){if(has_metrics_obj()){var b;b=a?"metered":"non-metered",metrics_obj.accessMeterData.meter_content_view_type=b}}};else{var view_offers={eVar:"eVar71",prop:"prop71",event:"75",desc:"Meter Interaction",other_metrics:["2","48"]},meter_count={eVar:"eVar72",prop:"prop72",desc:"Current Page #",cookie:"pq-count",default_val:"0",maxmet:"maxmet",pre_cookie:function(a){return captured_metrics[this.prop]===this.maxmet&&captured_metrics[this.eVar]===this.maxmet&&captured_metrics[meter_max.prop]===a&&captured_metrics[meter_max.eVar]===a&&(a=this.maxmet),a},pre_capture:function(a){return whitelist_pq.search_referrer.check()&&(a+=":search"),a}},meter_max={eVar:"eVar73",prop:"prop73",desc:"Max Page #",cookie:"pq-max",default_val:backend_facade.site_settings.reg_visits_threshold.toString()},meter_content_view_type={eVar:"eVar52",prop:"prop52",desc:"Content View Type",default_val:"non-metered"},meter_janrain_id={eVar:"eVar2",prop:"prop2",desc:"Janrain ID"};metrics_obj_name="cmg.s_coxnews",metrics_interface={track_converted_users:function(a,b){track_event(view_offers,a,b)},track_meter_count:function(a,b){"undefined"!=typeof a&&"undefined"!=typeof b?cmg.metrics_consolidator.apply_on_ready(function(a,b){track_non_event(meter_count,a),track_non_event(meter_max,b)},"meter_count/meter_max",[a.toString(),b.toString()]):(track_non_event(meter_count),track_non_event(meter_max))},track_content_view_type:function(a){if("undefined"!=typeof a){var b;b=a?"metered":"non-metered",cmg.metrics_consolidator.apply_on_ready(track_non_event,"content_view_type",[meter_content_view_type,b])}else track_non_event(meter_content_view_type)},track_janrain_id:function(a){track_non_event(meter_janrain_id,a)}}}return{track_converted_users:function(a,b){var c;b===backend_facade.modal_content_names.STICKY_MODAL?c="view all offers: sticky":b===backend_facade.modal_content_names.ROADBLOCK_MODAL&&(c="view all offers: roadblock"),metrics_interface.track_converted_users(a,c)},track_meter_count:metrics_interface.track_meter_count,track_content_view_type:metrics_interface.track_content_view_type,track_janrain_id:metrics_interface.track_janrain_id}}(cmg);cmg.passage_quota=new PassageQuota({max_visits:backend_facade.site_settings.reg_visits_threshold,period_length:"first_of_month",rolling_period:!1,max_visit_conditions:[],callbacks_for_current_visit:{"0-":max_reached,"1-":upsell,"1+":welcome}});var whitelist_pq=new WhiteListPQ(backend_facade.site_settings.whitelisted_urls,["news.google.com","www.google.com","www.bing.com"]),user_status_pq=new UserStatusPQ(backend_facade),auth_url="http://www.mystatesman.com/profile/janus-auth/";$(function(){if(pq_metrics.track_meter_count(),pq_metrics.track_content_view_type(),plate.getAliasParameters){var a=plate.getAliasParameters();a&&a.u&&pq_metrics.track_janrain_id(a.u)}}),cmg.authorization.check(auth_url,function(a){activate_pq(a.authorized)})}(window.cmg||(window.cmg={}),cmg.query||window.jQuery,window.janrain,window.plate||{}),"undefined"!=typeof window.plate&&"undefined"!=typeof wrap&&wrap.hasOwnProperty("premium")&&(window.plate.premium=wrap.premium);